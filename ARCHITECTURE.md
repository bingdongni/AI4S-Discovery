# 🏗️ AI4S-Discovery 架构文档

## 项目结构

```
AI4S-Discovery/
├── README.md                 # 项目主文档
├── LICENSE                   # Apache 2.0许可证
├── CONTRIBUTING.md           # 贡献指南
├── QUICKSTART.md            # 快速开始指南
├── PROJECT_STATUS.md        # 项目开发状态
├── ARCHITECTURE.md          # 架构文档（本文件）
├── requirements.txt         # Python依赖
├── .env.example            # 环境变量模板
├── .gitignore              # Git忽略配置
├── Dockerfile              # Docker镜像配置
├── docker-compose.yml      # Docker编排配置
├── main.py                 # 主入口文件
│
├── src/                    # 源代码目录
│   ├── __init__.py
│   │
│   ├── core/              # 核心模块
│   │   ├── __init__.py
│   │   └── config.py      # 配置管理
│   │
│   ├── utils/             # 工具模块
│   │   ├── __init__.py
│   │   ├── device_manager.py    # 设备管理（CPU/GPU）
│   │   └── logger_config.py     # 日志配置
│   │
│   ├── agents/            # 智能体模块
│   │   ├── __init__.py
│   │   ├── coordinator_agent.py  # 协调智能体
│   │   ├── search_agent.py       # 搜索智能体
│   │   ├── analysis_agent.py     # 分析智能体（待实现）
│   │   ├── relation_agent.py     # 关联智能体（待实现）
│   │   ├── generate_agent.py     # 生成智能体（待实现）
│   │   ├── evaluate_agent.py     # 评估智能体（待实现）
│   │   ├── patent_agent.py       # 专利智能体（待实现）
│   │   └── report_agent.py       # 报告智能体（待实现）
│   │
│   ├── api/               # API服务
│   │   ├── __init__.py
│   │   └── main.py        # FastAPI应用
│   │
│   ├── web/               # Web界面
│   │   ├── __init__.py
│   │   └── app.py         # Streamlit应用
│   │
│   ├── cli/               # 命令行工具（待实现）
│   │   ├── __init__.py
│   │   └── main.py
│   │
│   ├── database/          # 数据库模块（待实现）
│   │   ├── __init__.py
│   │   ├── sqlite_db.py   # SQLite操作
│   │   ├── neo4j_db.py    # Neo4j操作
│   │   └── vector_db.py   # 向量数据库
│   │
│   ├── models/            # 模型模块（待实现）
│   │   ├── __init__.py
│   │   ├── llm.py         # 大语言模型
│   │   ├── embedding.py   # 嵌入模型
│   │   └── gnn.py         # 图神经网络
│   │
│   └── algorithms/        # 算法模块（待实现）
│       ├── __init__.py
│       ├── trl_assessment.py    # TRL评估
│       ├── hypothesis_gen.py    # 假设生成
│       └── knowledge_transfer.py # 知识迁移
│
├── scripts/               # 脚本目录（待实现）
│   ├── init_database.py   # 数据库初始化
│   └── download_models.py # 模型下载
│
├── tests/                 # 测试目录（待实现）
│   ├── __init__.py
│   ├── test_agents/
│   ├── test_api/
│   └── test_utils/
│
├── docs/                  # 文档目录（待实现）
│   ├── api_reference.md
│   ├── deployment.md
│   └── development.md
│
├── templates/             # 报告模板（待实现）
│   ├── research_proposal.html
│   ├── literature_review.html
│   └── technical_report.html
│
├── data/                  # 数据目录（运行时创建）
│   ├── metadata.db        # SQLite数据库
│   └── vector_db/         # 向量数据库
│
├── logs/                  # 日志目录（运行时创建）
│   ├── ai4s_YYYY-MM-DD.log
│   └── error_YYYY-MM-DD.log
│
├── models/                # 模型目录（运行时创建）
│   ├── minicpm-2b/
│   └── embeddings/
│
├── cache/                 # 缓存目录（运行时创建）
│
└── reports/               # 报告目录（运行时创建）
```

## 核心架构设计

### 1. 四层架构

```
┌─────────────────────────────────────────────────────────────┐
│                      用户交互层                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ Web UI   │  │ REST API │  │ Python   │  │ CLI      │   │
│  │(Streamlit)│  │(FastAPI) │  │ SDK      │  │ Tool     │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    智能体协调层                              │
│              ┌──────────────────────┐                       │
│              │  Coordinator Agent   │                       │
│              │  (任务调度与协调)     │                       │
│              └──────────────────────┘                       │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    专业智能体层                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ Search   │  │ Analysis │  │ Relation │  │ Generate │   │
│  │ Agent    │  │ Agent    │  │ Agent    │  │ Agent    │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ Evaluate │  │ Patent   │  │ Quality  │  │ Report   │   │
│  │ Agent    │  │ Agent    │  │ Agent    │  │ Agent    │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                      数据处理层                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ SQLite   │  │ Neo4j    │  │ Redis    │  │ Vector   │   │
│  │ (元数据)  │  │ (图谱)   │  │ (缓存)   │  │ DB       │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    基础设施层                                │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ CPU/GPU  │  │ Docker   │  │ Task     │  │ Monitor  │   │
│  │ 调度     │  │ 容器     │  │ Scheduler│  │ 监控     │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 2. 多智能体协作流程

```
用户查询
    ↓
协调智能体（Coordinator）
    ├─→ 需求解析
    ├─→ 任务分解
    └─→ 智能体调度
         ↓
    ┌────┴────┬────────┬────────┬────────┐
    ↓         ↓        ↓        ↓        ↓
搜索智能体  分析智能体  关联智能体  评估智能体  生成智能体
    │         │        │        │        │
    └────┬────┴────────┴────────┴────────┘
         ↓
    结果整合与报告生成
         ↓
    返回给用户
```

### 3. 数据流

```
外部数据源 → 搜索智能体 → 原始数据
                ↓
            分析智能体 → 结构化数据
                ↓
            SQLite/Neo4j → 持久化存储
                ↓
            关联智能体 → 知识图谱
                ↓
            评估/生成智能体 → 高级分析
                ↓
            报告智能体 → 最终报告
```

## 核心模块说明

### 1. 协调智能体（Coordinator Agent）

**职责**:
- 接收用户研究需求
- 解析并分解为子任务
- 调度专业智能体执行
- 监控任务进度
- 整合结果

**关键方法**:
- `submit_task()` - 提交任务
- `_execute_task()` - 执行任务
- `get_task_status()` - 获取状态
- `get_task_result()` - 获取结果

### 2. 搜索智能体（Search Agent）

**职责**:
- 从多个学术数据源采集文献
- 并行搜索优化
- 结果去重和合并
- 反爬虫处理

**支持的数据源**:
- arXiv
- PubMed
- Semantic Scholar
- IEEE Xplore
- Springer（待实现）
- Elsevier（待实现）

### 3. 设备管理器（Device Manager）

**职责**:
- 检测硬件配置（CPU、GPU、内存）
- 动态设备切换
- 资源监控
- 性能优化

**关键特性**:
- 自动检测CUDA可用性
- 根据任务类型选择最优设备
- 实时资源监控
- GPU缓存管理

## 技术栈

### 后端
- **Python 3.8+** - 主要编程语言
- **FastAPI** - REST API框架
- **Streamlit** - Web界面框架
- **PyTorch** - 深度学习框架
- **Transformers** - 预训练模型库

### 数据库
- **SQLite** - 轻量级关系数据库
- **Neo4j** - 图数据库
- **Redis** - 缓存数据库
- **ChromaDB** - 向量数据库

### 工具库
- **loguru** - 日志管理
- **pydantic** - 数据验证
- **aiohttp** - 异步HTTP客户端
- **beautifulsoup4** - HTML解析

## 设计原则

1. **模块化**: 每个智能体独立开发和测试
2. **可扩展**: 易于添加新的数据源和智能体
3. **高性能**: CPU/GPU动态切换，资源优化
4. **可靠性**: 异常处理和自动重试
5. **可维护**: 清晰的代码结构和文档

## 性能优化策略

1. **异步处理**: 使用asyncio实现并发
2. **缓存机制**: Redis缓存热门查询
3. **批处理**: 批量处理文献数据
4. **模型量化**: INT8量化减少内存占用
5. **动态调度**: 根据负载选择设备

## 安全考虑

1. **API认证**: 基于密钥的认证
2. **数据加密**: AES-256加密敏感数据
3. **输入验证**: Pydantic模型验证
4. **日志审计**: 完整的操作日志
5. **权限控制**: 细粒度权限管理

---

**文档版本**: 1.0.0
**最后更新**: 2024-11-29